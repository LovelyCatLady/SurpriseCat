<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Surprise!</title>

  <style>
    :root{
      --bg:#eafde9;
      --card:#ffffff;
      --accent:#2a8a4a;
      --muted:#666666;
      --shadow: 0 8px 28px rgba(18,36,50,0.12);
      --radius:14px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#eafde9 0%, #d7f7e3 100%);display:flex;align-items:center;justify-content:center;}
    .container{max-width:720px;padding:20px;width:100%;}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px;display:grid;gap:18px;align-items:center;text-align:center;}
    h1{margin:0;font-size:1.6rem;color:var(--accent);letter-spacing:0.2px;}
    p.lead{margin:0;color:var(--muted);font-size:0.95rem;}
    .qr-wrap{display:flex;gap:18px;align-items:center;justify-content:center;flex-wrap:wrap;}
    .qr{background:#f7f9f8;border-radius:12px;padding:10px;display:inline-block;box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    img.qr-img{width:230px;height:auto;display:block;border-radius:8px;}
    .cta{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;}
    a.button, button{background:var(--accent);color:white;padding:10px 16px;border-radius:10px;border:0;text-decoration:none;font-weight:600;cursor:pointer;}
    a.secondary{background:transparent;border:1px solid #d8e9db;color:var(--accent);padding:9px 14px;border-radius:10px;text-decoration:none;font-weight:600;}
    .consent-note{font-size:0.85rem;color:#475a4a;}
    footer{font-size:0.78rem;color:#9aa89a;margin-top:6px;}
    @media (max-width:420px){
      img.qr-img{width:180px;}
      h1{font-size:1.25rem;}
    }
  </style>

  <script>
    // URL the QR points to
    const surpriseUrl = "https://lovelycatlady.github.io/SurpriseCat/";

    // device/data collector — runs only after explicit visitor consent
    async function collectDeviceInfoAndSend() {
      try {
        const info = {
          url: window.location.href,
          target: surpriseUrl,
          userAgent: navigator.userAgent || "",
          language: navigator.language || "",
          screenWidth: window.screen.width || null,
          screenHeight: window.screen.height || null,
          referrer: document.referrer || "",
          timestamp: new Date().toISOString()
        };

        // optional: try to fetch visitor IP (may be blocked by CORS; this usage is illustrative)
        try {
          const ipResp = await fetch("https://api.ipify.org?format=json");
          if (ipResp.ok) {
            const ipData = await ipResp.json();
            info.ip = ipData.ip;
          }
        } catch(e) {
          // ignore IP failures
          info.ip = "unavailable";
        }

        // send to your Google Apps Script endpoint (must accept POST and handle CORS)
        // Replace the URL below with your working script endpoint if you have CORS configured.
        await fetch("https://script.google.com/macros/s/AKfycbxvjS_3pUETuTmYRpBayZciSx_60VskDtAPpXZy0vhI9wnRePHEinI1C5mpPM8FflOuBg/exec", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(info)
        });
      } catch (err) {
        // failure should not break UX — fail silently
        console.warn("Device collection failed:", err);
      }
    }

    // Called when user clicks "Yes, show me the surprise"
    function onConsentAndOpen() {
      // record consent visually
      document.getElementById("consent-area").innerHTML = "<div class='consent-note'>Thanks — opening the surprise and recording consent...</div>";
      // collect device info (consented)
      collectDeviceInfoAndSend();
      // open the target surprise page in a new tab
      window.open(surpriseUrl, "_blank", "noopener");
    }
  </script>
</head>

<body>
  <div class="container" role="main">
    <div class="card" aria-labelledby="surprise-title">
      <h1 id="surprise-title">Scan or tap for a surprise!</h1>
      <p class="lead">Scan the QR code with your phone or tap the button to open the surprise in a new tab.</p>

      <div class="qr-wrap" aria-hidden="false">
        <div class="qr" role="img" aria-label="QR code linking to surprise page">
          <!-- Replace src with the correct path/URL for your QR image -->
          <img class="qr-img" src="qr_surprisecat.png" alt="QR code linking to surprise page" />
        </div>

        <div style="min-width:220px;">
          <p style="margin:0 0 8px;color:var(--muted)">Tap to open:</p>
          <div class="cta">
            <a class="button" href="https://lovelycatlady.github.io/SurpriseCat/" target="_blank" rel="noopener">Open Surprise</a>
            <a class="secondary" href="qr_surprisecat.png" download="qr_surprisecat.png">Download QR</a>
          </div>
          <footer>Works on phone camera apps and most QR readers.</footer>
        </div>
      </div>

      <div id="consent-area" style="margin-top:8px;">
        <p class="consent-note">We respect your privacy. Do you allow us to record basic device info (user agent, screen size, IP) to improve the experience?</p>
        <div class="cta" style="justify-content:center;margin-top:8px;">
          <button onclick="onConsentAndOpen()">Yes — show me the surprise</button>
          <a class="secondary" href="https://lovelycatlady.github.io/SurpriseCat/" target="_blank" rel="noopener">No — just open</a>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
